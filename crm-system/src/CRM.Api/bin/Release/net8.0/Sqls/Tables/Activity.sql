CREATE TABLE IF NOT EXISTS crm_activity (
  Id BIGINT PRIMARY KEY AUTO_INCREMENT,
  ExternalId VARCHAR(255) NULL,
  ConversationId VARCHAR(255) NULL,
  SourceFrom VARCHAR(100) NULL,
  Subject VARCHAR(500) NULL,
  Body TEXT NULL,
  ActivityType ENUM('email','call','meeting','task','note','reminder','other') NOT NULL DEFAULT 'note',
  CreatedOn DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  DueAt DATETIME NULL,
  CompletedAt DATETIME NULL,
  Status ENUM('open','in_progress','completed','cancelled','overdue') NOT NULL DEFAULT 'open',
  Priority ENUM('low','normal','high','urgent') NOT NULL DEFAULT 'normal',
  AssignedTo VARCHAR(255) NULL,
  RelationType VARCHAR(50) NULL,
  RelationId BIGINT NULL,
  CreatedBy VARCHAR(255) NULL,
  CallDuration INT NULL,
  CallOutcome VARCHAR(100) NULL,
  UpdatedOn DATETIME NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  UpdatedBy VARCHAR(255) NULL,

  INDEX idx_crm_activity_external_id (ExternalId),
  INDEX idx_crm_activity_conversation_id (ConversationId),
  INDEX idx_crm_activity_type (ActivityType),
  INDEX idx_crm_activity_status (Status),
  INDEX idx_crm_activity_priority (Priority),
  INDEX idx_crm_activity_assigned_to (AssignedTo),
  INDEX idx_crm_activity_relation (RelationType, RelationId),
  INDEX idx_crm_activity_due_at (DueAt),
  INDEX idx_crm_activity_completed_at (CompletedAt),
  INDEX idx_crm_activity_created_on (CreatedOn),
  INDEX idx_crm_activity_updated_on (UpdatedOn)
);
